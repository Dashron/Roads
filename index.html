<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Roads by Dashron</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Roads</h1>
      <h2 class="project-tagline">A node.js web framework</h2>
      <a href="https://github.com/Dashron/roads" class="btn">View on GitHub</a>
      <a href="https://github.com/Dashron/roads/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/Dashron/roads/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <h1>
<a id="the-roadsjs-isomophic-web-framework" class="anchor" href="#the-roadsjs-isomophic-web-framework" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>The Roads.js isomophic web framework</h1>

<p>Roads is a web framework built on Generators. It's similar to Koa.js, but can be used both in the browser and on the server.</p>

<h1>
<a id="why-should-i-use-roads" class="anchor" href="#why-should-i-use-roads" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Why should I use Roads?</h1>

<ol>
<li>Roads can be attached to any node HTTP server, including Koa.js, Express.js, and the built in node HTTP server.</li>
<li>Roads is isomorphic, meaning you can generate html on the server or in the browser with the same code.</li>
<li>Roads lets you work without callbacks. It's built on top of promises and generator-based coroutines.</li>
<li>Roads can be run without ever attaching it to an HTTP server. This is great for writing tests, working with web sockets, or writing API first websites. </li>
</ol>

<h1>
<a id="build-status" class="anchor" href="#build-status" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Build Status</h1>

<p><img src="https://travis-ci.org/Dashron/roads.svg?branch=master" alt="Build status"></p>

<h1>
<a id="index" class="anchor" href="#index" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Index</h1>

<ul>
<li><a href="#getting-started">Getting Started</a></li>
<li>
<a href="#roadsroad">Roads.Road</a>

<ul>
<li><a href="#new-roadresourcearray-root_resource">new Road(<em>Resource|array</em> root_resource)</a></li>
<li><a href="#roadusefunction-fn">use(<em>Function</em> fn)</a></li>
<li><a href="#roadrequeststring-method-string-url-dynamic-body-object-headers">request(<em>string</em> method, <em>string</em> url, <em>dynamic</em> body, <em>Object</em> headers)</a></li>
<li><a href="#roadaddresourceresource-resource">addResource(<em>Resource</em> resource)</a></li>
</ul>
</li>
<li>
<a href="#roadsresource">Roads.Resource</a>

<ul>
<li><a href="#new-resourceobject-definition">new Resource(<em>Object</em> definition)</a></li>
<li><a href="#url-part-routing">URL Part (routing)</a></li>
<li><a href="#resource-method">Resource method</a></li>
</ul>
</li>
<li>
<a href="#roadsresponse">Roads.Response</a>

<ul>
<li><a href="#new-responsemixed-body-number-status-object-headers">new Response(<em>mixed</em> body, <em>number</em> status, <em>Object</em> headers)</a></li>
<li><a href="#body">body</a></li>
<li><a href="#status">status</a></li>
<li><a href="#headers">headers</a></li>
<li><a href="#responsewritetoserverserverresponse-http_response">writeTo(<em>ServerResponse</em> httpResponse)</a></li>
</ul>
</li>
<li>
<a href="#roadshttperror">Roads.HttpError</a>

<ul>
<li><a href="#new-httperrorstring-message-number-code">new HttpError(<em>string</em> message, <em>number</em> code)</a></li>
</ul>
</li>
<li>
<a href="#roadsmiddleware">Roads.middleware</a>

<ul>
<li><a href="#killslash">killSlash()</a></li>
<li><a href="#corsarraystring-allow_origins-array-allow_headers">cors(<em>Array|string</em> allow_origins, <em>Array</em> allow_headers)</a></li>
</ul>
</li>
<li><a href="#roadsbuildstring-input_file-string-output_file-object-options">Roads.build</a></li>
<li>
<a href="#roadspjaxobject-road">Roads.PJAX(<em>Object</em> road)</a>

<ul>
<li><a href="#pjaxregisterobject-window-domelement-container_element">register(<em>Object</em> window, <em>DomElement</em> container_element)</a></li>
<li><a href="#pjax-link-format">PJAX Link Format</a></li>
<li><a href="#pjax-page-titles">PJAX Page titles</a></li>
<li><a href="#isomorphic-pjax-tips">Isomorphic PJAX tips</a></li>
</ul>
</li>
</ul>

<h2>
<a id="getting-started" class="anchor" href="#getting-started" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Getting Started</h2>

<p>Building a project with roads is very straightforward.</p>

<ol>
<li>
<p>Create your root <a href="#roadsresource">Resource</a>. This resource will be used for any request to the root (<code>/</code>) endpoint. Other endpoints will be defined in step 4.</p>

<div class="highlight highlight-source-js"><pre><span class="pl-c">// Create your resource.</span>
<span class="pl-k">var</span> resource <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">roads.Resource</span>({
    <span class="pl-c">// Define the supported HTTP methods. See step 2 for more details</span>
    methods<span class="pl-k">:</span> <span class="pl-k">...</span>
});

<span class="pl-c">// Assign your root resource to the Road.</span>
<span class="pl-k">var</span> road <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">roads.Road</span>(resource);</pre></div>
</li>
<li>
<p>Each <a href="#roadsresource">Resource</a> from step #1 should contain one or more <a href="#resource-method">resource methods</a>. Each resource method is associated with an HTTP method.</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> resource <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">roads.Resource</span>({
    <span class="pl-c">// Define the supported HTTP methods.</span>
    methods<span class="pl-k">:</span> {
        <span class="pl-c">// Whenever a GET request is made to this resource, it will execute the following function</span>
        <span class="pl-en">GET</span><span class="pl-k">:</span> <span class="pl-k">function</span> (<span class="pl-smi">url</span>, <span class="pl-smi">body</span>, <span class="pl-smi">headers</span>) {
            <span class="pl-c">// URL is parsed via the url module. The following code will access the querystring parameter "page"</span>
            <span class="pl-smi">url</span>.<span class="pl-smi">query</span>.<span class="pl-smi">page</span>;

            <span class="pl-c">// JSON or query body, parsed depending on the content-type header.</span>
            <span class="pl-smi">body</span>.<span class="pl-c1">name</span>;

            <span class="pl-c">// Incomplete, see step 3.</span>
            <span class="pl-k">return</span> <span class="pl-k">...</span>
        }
    }
});</pre></div>

<p><strong>note:</strong> Resource methods are not required. If you do not include any resource methods, roads will still search through all sub-resources.</p>
</li>
<li>
<p>Each <a href="#resource-method">resource method</a> from step #2 should return your response. If you return a promise which will be resolved and the response/errors will be handled appropriately. If you do not return (or your promise does not resolve) a <a href="#roadsresponse">response</a> object it will be automatically wrapped in a response object.</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> resource <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">roads.Resource</span>({
    <span class="pl-c">// Define the supported HTTP methods.</span>
    methods<span class="pl-k">:</span> {
        <span class="pl-en">GET</span><span class="pl-k">:</span> <span class="pl-k">function</span> (<span class="pl-smi">url</span>, <span class="pl-smi">body</span>, <span class="pl-smi">headers</span>) {
            <span class="pl-c">// Perform your route logic, see step 2.</span>
            <span class="pl-k">...</span>

            <span class="pl-c">// Build a response object, with the body, status code and headers.</span>
            <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-en">this.Response</span>({ <span class="pl-s"><span class="pl-pds">"</span>name<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>aaron<span class="pl-pds">"</span></span> }, <span class="pl-c1">200</span>, {<span class="pl-s"><span class="pl-pds">"</span>last-modified<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>Tue, 15 Nov 1994 12:45:26 GMT<span class="pl-pds">"</span></span>});
        }
    }
});</pre></div>
</li>
<li>
<p>Assign sub-resources to the root resource. These will be attached to endpoints under this resource (e.g. <code>/</code> contains <code>/users</code>. <code>/users</code> will contain <code>/users/#user_id</code>) All subresources are resources objects like the root resource defined in step 1, so you can continue to follow steps 1-4 to build out your sub resources.</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> resource <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">roads.Resource</span>({
    <span class="pl-c">// Define the supported HTTP methods. See steps 2 and 3.</span>
    methods<span class="pl-k">:</span> <span class="pl-k">...</span> ,
    <span class="pl-c">// Define sub-resources. </span>
    resources<span class="pl-k">:</span>         {
        <span class="pl-c">// This assumes the file located at `./users` exposes another `Resource` object. That resource will be bound to the route `/users`.</span>
        <span class="pl-s"><span class="pl-pds">"</span>users<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>./users<span class="pl-pds">'</span></span>),
        <span class="pl-c">// This assumes the file located at `./posts` exposes another `Resource` object. That resource will be bound to the route `/posts`.</span>
        <span class="pl-s"><span class="pl-pds">"</span>posts<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>./posts<span class="pl-pds">'</span></span>)
    },
});</pre></div>
</li>
<li>
<p>Now you want to run your code. There are four options in this library.</p>

<ul>
<li>
<p>You can tie the road to node's standard HTTP Server. This will automatically route any HTTP requests to that server into your road.</p>

<div class="highlight highlight-source-js"><pre>  <span class="pl-c">// Tie to node's HTTP server</span>
  <span class="pl-k">const</span> <span class="pl-c1">roads</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>roads<span class="pl-pds">'</span></span>);

  <span class="pl-k">var</span> road <span class="pl-k">=</span> <span class="pl-k">...</span>; <span class="pl-c">// See steps 1-4 for road construction</span>
  <span class="pl-k">var</span> server <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">roads.Server</span>(road, <span class="pl-k">function</span> (<span class="pl-smi">error</span>) {
      <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>roads encountered an error<span class="pl-pds">'</span></span>, error);
  });

  <span class="pl-smi">server</span>.<span class="pl-en">listen</span>(<span class="pl-c1">8080</span>);</pre></div>
</li>
<li>
<p>You can use the road as a router for your Koa.js server.</p>

<div class="highlight highlight-source-js"><pre>  <span class="pl-c">// Tie to node's HTTP server</span>
  <span class="pl-k">const</span> <span class="pl-c1">roads</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>roads<span class="pl-pds">'</span></span>);
  <span class="pl-k">const</span> <span class="pl-c1">koa</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>koa<span class="pl-pds">'</span></span>);

  <span class="pl-k">var</span> road <span class="pl-k">=</span> <span class="pl-k">...</span>; <span class="pl-c">// See steps 1-4 for road construction</span>
  <span class="pl-k">var</span> app <span class="pl-k">=</span> <span class="pl-en">koa</span>();
  <span class="pl-smi">app</span>.<span class="pl-en">use</span>(<span class="pl-smi">roads</span>.<span class="pl-smi">integrations</span>.<span class="pl-en">koa</span>(road));
  <span class="pl-smi">app</span>.<span class="pl-en">listen</span>(<span class="pl-c1">8080</span>);
</pre></div>
</li>
<li>
<p>You can Manually execute a resource method. This will behave just like a web request without having to use HTTP.</p>

<div class="highlight highlight-source-js"><pre>    <span class="pl-c">// Tie to node's HTTP server</span>
    <span class="pl-k">const</span> <span class="pl-c1">roads</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>roads<span class="pl-pds">'</span></span>);

    <span class="pl-k">var</span> road <span class="pl-k">=</span> <span class="pl-k">...</span>; <span class="pl-c">// See steps 1-4 for road construction</span>

    <span class="pl-c">// Call directly</span>
    <span class="pl-smi">road</span>.<span class="pl-en">request</span>(<span class="pl-s"><span class="pl-pds">'</span>GET<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>/users<span class="pl-pds">'</span></span>, {page<span class="pl-k">:</span> <span class="pl-c1">2</span>})
        .<span class="pl-en">then</span>(<span class="pl-k">function</span> (<span class="pl-smi">response</span>) {
            <span class="pl-en">console</span>.<span class="pl-c1">log</span>(response);
        });</pre></div>
</li>
<li>
<p>You can use browserify to compile everything for use in the browser.</p>

<p><strong>client_index.js</strong></p>

<div class="highlight highlight-source-js"><pre>    <span class="pl-k">const</span> <span class="pl-c1">roads</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>roads<span class="pl-pds">'</span></span>);
    <span class="pl-k">var</span> road <span class="pl-k">=</span> <span class="pl-k">...</span>; <span class="pl-c">// See steps 1-4 for road construction</span>

    <span class="pl-c">// Make a client side request. See the PJAX section of the docs for more client side options</span>
    <span class="pl-smi">road</span>.<span class="pl-en">request</span>(<span class="pl-s"><span class="pl-pds">'</span>GET<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>/users<span class="pl-pds">'</span></span>, {page<span class="pl-k">:</span> <span class="pl-c1">2</span>})
        .<span class="pl-en">then</span>(<span class="pl-k">function</span> (<span class="pl-smi">response</span>) {
            <span class="pl-en">console</span>.<span class="pl-c1">log</span>(response);
        });
</pre></div>

<p><strong>build.js</strong></p>

<div class="highlight highlight-source-js"><pre>    <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>roads<span class="pl-pds">'</span></span>).<span class="pl-en">build</span>(<span class="pl-s"><span class="pl-pds">'</span>client_index.js<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>/build/client.js<span class="pl-pds">'</span></span>, {
        roads<span class="pl-k">:</span> {
            output_file<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">'</span>./build/roads.js<span class="pl-pds">'</span></span>,
        }
    });
</pre></div>
</li>
</ul>
</li>
</ol>

<p>Now that you can use your roads server, continue reading the docs below for more information on <a href="#roadusefunction-fn">error handling</a>, <a href="#url-part">URL parameters</a> and more!</p>

<h2>
<a id="roadsroad" class="anchor" href="#roadsroad" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Roads.Road</h2>

<p>A Road is a container that holds a hierarchy of <a href="#roadsresource">Resource</a> objects. It exposes a <a href="#requeststring-method-string-url-dynamic-body-object-headers">request</a> method which allows you to interact directly with the resources.</p>

<h3>
<a id="new-roadresourcearray-root_resource" class="anchor" href="#new-roadresourcearray-root_resource" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>new Road(<em>Resource|array</em> root_resource)</h3>

<p><strong>Create a Road.</strong></p>

<table>
<thead>
<tr>
<th>name</th>
<th>type</th>
<th>required</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>root_resource</td>
<td>
<a href="#roadsresource">Resource</a> or array</td>
<td>yes</td>
<td>Used to generate the <a href="#roadsresponse">response</a> for the root endpoint ( [protocol]://[host]/ ). Also determines the starting point for routing for the <a href="#requeststring-method-string-url-dynamic-body-object-headers">request</a> method.</td>
</tr>
</tbody>
</table>

<p>Creates your Road object. You must provide at least one root <a href="#roadsresource">Resource</a> to the constructor. These <a href="#roadsresource">resources</a> will be mounted to the root (<code>/</code>) endpoint. The <a href="#requeststring-method-string-url-dynamic-body-object-headers">request</a> method will search these <a href="#roadsresource">resources</a> for a matching route. If you provide an array of <a href="#roadsresource">resources</a> is, it will search through them in array order. </p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">const</span> <span class="pl-c1">roads</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>roads<span class="pl-pds">'</span></span>);
<span class="pl-k">var</span> root_resource <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">roads.Resource</span>(<span class="pl-k">...</span>); <span class="pl-c">// The resource definition has not been set here, because it's out of the scope of this example. Take a look at [Resource](#roadsresource) for information about the Resource constructor.</span>
<span class="pl-c">// Create a road with a single resource</span>
<span class="pl-k">var</span> road <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">roads.Road</span>(root_resource);</pre></div>

<div class="highlight highlight-source-js"><pre><span class="pl-k">const</span> <span class="pl-c1">roads</span> <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>roads<span class="pl-pds">'</span></span>);
<span class="pl-k">var</span> root_resource <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">roads.Resource</span>(<span class="pl-k">...</span>); <span class="pl-c">// The resource definition has not been set here, because it's out of the scope of this example. Take a look at [Resource](#roadsresource) for information about the Resource constructor.</span>
<span class="pl-k">var</span> root_resource2 <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">roads.Resource</span>(<span class="pl-k">...</span>); 
<span class="pl-c">// Create a road with multiple resources. If the route is found in root_resource, request will never search root_resource2</span>
<span class="pl-k">var</span> road <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">roads.Road</span>([root_resource, root_resource2]);</pre></div>

<h3>
<a id="roadusefunction-fn" class="anchor" href="#roadusefunction-fn" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Road.use(<em>Function</em> fn)</h3>

<p><strong>Add a custom function that will be executed before every request.</strong></p>

<p>This function can be called one or more times. Each time it is called, the provided function will be added to a queue that is executed before every request. The execution order will match the order the middleware functions were added to the road. Each middleware function can choose whether or not it wants to progress to the following middleware function, and ultimately the final <a href="#resource-method">resource method</a>.</p>

<table>
<thead>
<tr>
<th>name</th>
<th>type</th>
<th>required</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>fn</td>
<td>Function(<em>string</em> method, <em>string</em> url,<em>object</em> body,<em>object</em> headers,<em>function</em> next)</td>
<td>yes</td>
<td>Will be called any time a request is made on the object.</td>
</tr>
</tbody>
</table>

<p>This will be called for every request, even for routes that do not exist. The callback will be executed with the following five parameters:</p>

<h4>
<a id="use-callback" class="anchor" href="#use-callback" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>use Callback</h4>

<p><strong>function (<em>string</em> method,<em>string</em> url, <em>Object</em> body, <em>Object</em> headers, <em>Function</em> next)</strong></p>

<table>
<thead>
<tr>
<th>name</th>
<th>type</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>method</td>
<td>string</td>
<td>The HTTP method that was provided to the request</td>
</tr>
<tr>
<td>url</td>
<td>string</td>
<td>The URL that was provided to the request</td>
</tr>
<tr>
<td>body</td>
<td>object</td>
<td>The body that was provided to the request, after it was properly parsed into an object</td>
</tr>
<tr>
<td>headers</td>
<td>object</td>
<td>The headers that were provided to the request</td>
</tr>
<tr>
<td>next</td>
<td>function</td>
<td>The next step of the handler chain. If there are no more custom handlers assigned, next will resolve to the <a href="#resource-method">resource method</a> that the router located. This method will always return a promise.</td>
</tr>
</tbody>
</table>

<p>If the callback does not return a <a href="#roadsresponse">response</a> object, the return value will become the body of a new <a href="#roadsresponse">response</a> object with the default status code of 200.</p>

<div class="highlight highlight-source-js"><pre><span class="pl-c">// Example of a request handler that kills trailing slashes (This is provided for you in the middleware!)</span>
<span class="pl-c">// The main logic of this function will be executed before the resource method, because it all happens before the middleware calls next()</span>
<span class="pl-smi">road</span>.<span class="pl-en">use</span>(<span class="pl-k">function</span> (<span class="pl-smi">method</span>, <span class="pl-smi">url</span>, <span class="pl-smi">body</span>, <span class="pl-smi">headers</span>, <span class="pl-smi">next</span>) {
    <span class="pl-c">// kill trailing slash as long as we aren't at the root level</span>
    <span class="pl-k">if</span> (<span class="pl-smi">url</span>.<span class="pl-smi">path</span> <span class="pl-k">!=</span> <span class="pl-s"><span class="pl-pds">'</span>/<span class="pl-pds">'</span></span> <span class="pl-k">&amp;&amp;</span> <span class="pl-smi">url</span>.<span class="pl-smi">path</span>[<span class="pl-smi">url</span>.<span class="pl-smi">path</span>.<span class="pl-c1">length</span> <span class="pl-k">-</span> <span class="pl-c1">1</span>] <span class="pl-k">===</span> <span class="pl-s"><span class="pl-pds">'</span>/<span class="pl-pds">'</span></span>) {
        <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-en">roads.Response</span>(<span class="pl-c1">null</span>, <span class="pl-c1">302</span>, {
            location<span class="pl-k">:</span> <span class="pl-smi">url</span>.<span class="pl-smi">path</span>.<span class="pl-c1">substring</span>(<span class="pl-c1">0</span>, <span class="pl-smi">url</span>.<span class="pl-smi">path</span>.<span class="pl-c1">length</span> <span class="pl-k">-</span> <span class="pl-c1">1</span>)
        });
    }

    <span class="pl-k">return</span> <span class="pl-en">next</span>();
});

<span class="pl-c">// Example of a request handler that catches errors and returns Response objects</span>
<span class="pl-c">// The main logic of this function will execute after the resource method,  because it all happens after the middleware calls next()</span>
<span class="pl-smi">road</span>.<span class="pl-en">use</span>(<span class="pl-k">function</span>(<span class="pl-smi">method</span>, <span class="pl-smi">url</span>, <span class="pl-smi">body</span>, <span class="pl-smi">headers</span>, <span class="pl-smi">next</span>) {
    <span class="pl-c">// execute the actual resource method, and return the response</span>
    <span class="pl-k">return</span> <span class="pl-en">next</span>()
        <span class="pl-c">// Catch any errors that are thrown by the resources</span>
        .<span class="pl-en">catch</span> (<span class="pl-k">function</span> (<span class="pl-smi">err</span>) {
            <span class="pl-c">// Wrap the errors in response objects. If they are [HttpErrors](#roadshttperror) we adjust the status code</span>
            <span class="pl-k">switch</span> (<span class="pl-smi">err</span>.<span class="pl-c1">code</span>) {
                <span class="pl-k">case</span> <span class="pl-c1">404</span><span class="pl-k">:</span>
                    <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-en">roads.Response</span>(<span class="pl-en">notFoundRepresentation</span>(err), <span class="pl-c1">404</span>);
                <span class="pl-k">case</span> <span class="pl-c1">405</span><span class="pl-k">:</span>
                    <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-en">roads.Response</span>(<span class="pl-en">notAllowedRepresentation</span>(err), <span class="pl-c1">405</span>);
                <span class="pl-k">case</span> <span class="pl-c1">500</span><span class="pl-k">:</span>
                <span class="pl-k">default</span><span class="pl-k">:</span>
                    <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-en">roads.Response</span>(<span class="pl-en">unknownRepresentation</span>(err), <span class="pl-c1">500</span>);
            }
        });
});</pre></div>

<h3>
<a id="roadrequeststring-method-string-url-dynamic-body-object-headers" class="anchor" href="#roadrequeststring-method-string-url-dynamic-body-object-headers" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Road.request(<em>string</em> method, <em>string</em> url, <em>dynamic</em> body, <em>Object</em> headers)</h3>

<p><strong>Locate and execute the resource method associated with the request parameters.</strong></p>

<p>This function will locate the appropriate <a href="#resource-method">resource method</a> for the provided HTTP Method and URL, execute it and return a <a href="http://wiki.commonjs.org/wiki/Promises/A">thenable (Promises/A compatible promise)</a>. The thenable will always resolve to a <a href="#roadsresponse">Response</a> object.</p>

<p>If no <a href="#resource">resource</a> is found for the requested url, the <a href="http://wiki.commonjs.org/wiki/Promises/A">thenable</a> will surface an <a href="#roadshttperror">HttpError</a> with a 404 status code.</p>

<p>If a <a href="#resource">resource</a> is found for the requested url, but no <a href="#resource-method">resource method</a>, the <a href="http://wiki.commonjs.org/wiki/Promises/A">thenable</a> will surface an <a href="#roadshttperror">HttpError</a> with a 405 status code.</p>

<p>If the system encounters an unexpected error, it will try to throw an <a href="#roadshttperror">HttpError</a> with a 500 status code, but it's always worth checking the error type just in case.</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> promise <span class="pl-k">=</span> <span class="pl-smi">road</span>.<span class="pl-en">request</span>(<span class="pl-s"><span class="pl-pds">'</span>GET<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>/users/dashron<span class="pl-pds">'</span></span>);

<span class="pl-smi">promise</span>.<span class="pl-en">then</span>(<span class="pl-k">function</span> (<span class="pl-smi">response</span>) {        
    <span class="pl-en">console</span>.<span class="pl-c1">log</span>(response);
});

<span class="pl-smi">promise</span>.<span class="pl-en">catch</span>(<span class="pl-k">function</span> (<span class="pl-smi">error</span>) {
    <span class="pl-en">console</span>.<span class="pl-c1">log</span>(error);
});</pre></div>

<h3>
<a id="roadaddresourceresource-resource" class="anchor" href="#roadaddresourceresource-resource" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Road.addResource(<em>Resource</em> resource)</h3>

<p><strong>Add another resource for the router.</strong></p>

<p>This resource will be added to the end of the array of resources passed in through the <a href="#new-roadresourcearray-root_resource">constructor</a>. Read up on more details in the <a href="#new-roadresourcearray-root_resource">constructor's docs</a>.</p>

<h2>
<a id="roadsresource" class="anchor" href="#roadsresource" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Roads.Resource</h2>

<p>Each resource represents a single endpoint. It can contain a list of sub-resources (to help build a structured url path), or <a href="#resource-method">resource methods</a> (to handle each HTTP method for this endpoint).</p>

<h3>
<a id="new-resourceobject-definition" class="anchor" href="#new-resourceobject-definition" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>new Resource(<em>Object</em> definition)</h3>

<p><strong>Constructor</strong></p>

<table>
<thead>
<tr>
<th>name</th>
<th>type</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>definition</td>
<td>object</td>
<td>A definition which describes how the resource should operate</td>
</tr>
</tbody>
</table>

<p>The definition only looks for three fields.</p>

<table>
<thead>
<tr>
<th>name</th>
<th>type</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>resources</td>
<td>object</td>
<td>Each key is a <a href="#url-part">URL part</a>, and each value is a sub-<a href="#roadsresource">resource</a>
</td>
</tr>
<tr>
<td>methods</td>
<td>object</td>
<td>Each key is an HTTP method, and each value is a <a href="#resource-method">resource method</a>.</td>
</tr>
<tr>
<td>context</td>
<td>mixed</td>
<td>The value of the Resource context will appear in the <a href="#context">context</a> of every <a href="#resource-method">resource method</a> with the key <code>resource_context</code>
</td>
</tr>
</tbody>
</table>

<div class="highlight highlight-source-js"><pre><span class="pl-c1">module</span>.<span class="pl-smi">exports</span>.<span class="pl-smi">many</span> <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Resource</span>({
    resources<span class="pl-k">:</span> {
        <span class="pl-s"><span class="pl-pds">'</span>users<span class="pl-pds">'</span></span><span class="pl-k">:</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>./users<span class="pl-pds">'</span></span>).<span class="pl-smi">many</span>,
        <span class="pl-s"><span class="pl-pds">'</span>posts<span class="pl-pds">'</span></span><span class="pl-k">:</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>./posts<span class="pl-pds">'</span></span>).<span class="pl-smi">many</span>
    },
    methods<span class="pl-k">:</span> {
        <span class="pl-en">GET</span><span class="pl-k">:</span> <span class="pl-k">function</span><span class="pl-k">*</span> (<span class="pl-smi">url</span>, <span class="pl-smi">body</span>, <span class="pl-smi">headers</span>) {
            <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-en">Response</span>({
                <span class="pl-s"><span class="pl-pds">"</span>users<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>/users<span class="pl-pds">"</span></span>,
                <span class="pl-s"><span class="pl-pds">"</span>posts<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>/posts<span class="pl-pds">"</span></span>
            });
        }
    }
});</pre></div>

<h4>
<a id="url-part-routing" class="anchor" href="#url-part-routing" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>URL Part (routing)</h4>

<p>All URL routing is defined through the resource definition, and through sub-resources. The root resource represents a URL without any path ([protocol]://[host]/). This root resource must define additional resources as sub-resources, which will branch out after the root resource.</p>

<table>
<thead>
<tr>
<th>Part</th>
<th>Example</th>
<th>Example values</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>{literal}</td>
<td>users</td>
<td>users</td>
<td>The provided value must explicitly match the <a href="#url-part">URL part</a>
</td>
</tr>
<tr>
<td>#{key}</td>
<td>#user_id</td>
<td>12445</td>
<td>The provided value must be numeric</td>
</tr>
<tr>
<td>${key}</td>
<td>#username</td>
<td>dashron</td>
<td>The provided value can be any series of non-forward slash, URL valid characters</td>
</tr>
</tbody>
</table>

<p>In the following example, the only valid URLs are <code>/</code>, <code>/users</code> and <code>/users/{number}</code></p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> single <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Resource</span>({
});

<span class="pl-k">var</span> many <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Resource</span>({
    resources<span class="pl-k">:</span> {
        <span class="pl-s"><span class="pl-pds">"</span>#user_id<span class="pl-pds">"</span></span><span class="pl-k">:</span> single
    }
});

<span class="pl-k">var</span> root <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Resource</span>({
    resources<span class="pl-k">:</span> {
        <span class="pl-s"><span class="pl-pds">"</span>users<span class="pl-pds">"</span></span><span class="pl-k">:</span> many
    }
});</pre></div>

<p>For variable fields, you can retrieve the variable in the URL parameter. The URL parameter will be an object, and will have an "args" parameter</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> single <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Resource</span>({
    <span class="pl-en">methods</span><span class="pl-k">:</span> <span class="pl-k">function</span> (<span class="pl-smi">url</span>, <span class="pl-smi">body</span>, <span class="pl-smi">headers</span>) {
        <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-smi">url</span>.<span class="pl-smi">args</span>.<span class="pl-smi">user_id</span>);
    }
});

<span class="pl-k">var</span> many <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Resource</span>({
    resources<span class="pl-k">:</span> {
        <span class="pl-s"><span class="pl-pds">"</span>#user_id<span class="pl-pds">"</span></span><span class="pl-k">:</span> single
    }
});

<span class="pl-k">var</span> root <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Resource</span>({
    resources<span class="pl-k">:</span> {
        <span class="pl-s"><span class="pl-pds">"</span>users<span class="pl-pds">"</span></span><span class="pl-k">:</span> many
    }
});</pre></div>

<h4>
<a id="resource-method" class="anchor" href="#resource-method" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Resource Method</h4>

<p>The methods section of the resource definition should be an object which contains many key value pairs. The keys must be one of the HTTP methods (GET, POST, PUT, PATCH, DELETE, OPTIONS, etc). The value for these keys must be an object, a function, or a generator. These are called "<a href="#resource-method">resource methods</a>". Resource methods are used by <a href="#roadrequeststring-method-string-url-dynamic-body-object-headers">Road.request</a> when trying to run your program. First <code>request</code> finds the resource from the request path, and then the <a href="#resource-method">resource method</a> from the request method.  </p>

<h5>
<a id="resource-method-functions" class="anchor" href="#resource-method-functions" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Resource Method Functions</h5>

<p>If you provide a function, this function will be executed any time the corresponding HTTP method is run. This function will be passed three parameters.</p>

<table>
<thead>
<tr>
<th>name</th>
<th>type</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>url</td>
<td>string</td>
<td>The URL of the request. Is parsed with the standard url module.</td>
</tr>
<tr>
<td>body</td>
<td>object</td>
<td>The request body. If the <code>Content-Type</code> header is <code>application/json</code> the body will be parsed into an object.</td>
</tr>
<tr>
<td>headers</td>
<td>object</td>
<td>The request headers</td>
</tr>
</tbody>
</table>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> road <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Road</span>(<span class="pl-k">new</span> <span class="pl-en">Resource</span>({
    methods<span class="pl-k">:</span> {
        <span class="pl-en">GET</span><span class="pl-k">:</span> <span class="pl-k">function</span> (<span class="pl-smi">url</span>, <span class="pl-smi">body</span>, <span class="pl-smi">headers</span>) {
            <span class="pl-k">return</span> <span class="pl-s"><span class="pl-pds">'</span>Welcome!<span class="pl-pds">'</span></span>;
        }
    }
}));

##### Resource Method Generators

If you provide a generator <span class="pl-k">function</span> as your resource method, we will turn it into a coroutine. Coroutines mimic ES7 async functions by letting you yield promises. It lets you drastically improve the readability of your code. If you would like to read more about coroutines, check out my blog post here: 

```node
var road = new <span class="pl-en">Road</span>(<span class="pl-k">new</span> <span class="pl-en">Resource</span>({
    methods<span class="pl-k">:</span> {
        <span class="pl-en">GET</span><span class="pl-k">:</span> <span class="pl-k">function</span><span class="pl-k">*</span> (<span class="pl-smi">url</span>, <span class="pl-smi">body</span>, <span class="pl-smi">headers</span>) {
            <span class="pl-k">try</span> {
                <span class="pl-k">var</span> user <span class="pl-k">=</span> <span class="pl-k">yield</span> <span class="pl-smi">db</span>.<span class="pl-en">User</span>(<span class="pl-smi">url</span>.<span class="pl-smi">args</span>.<span class="pl-smi">user_id</span>);
            } <span class="pl-k">catch</span> (e) {
                <span class="pl-en">console</span>.<span class="pl-c1">log</span>(e);
            }
        }
    }
}));</pre></div>

<h5>
<a id="resource-method-objects" class="anchor" href="#resource-method-objects" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Resource Method Objects</h5>

<p>If you provide an object instead of a function or a generator, this allows you to define the resource method's function along with additional contextual data that will exist in the request context. The resource method must be provided as the value to the key <code>fn</code>. Within the context of fn, you can find the entire resource method object on the key "method_context".</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> road <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Road</span>(<span class="pl-k">new</span> <span class="pl-en">Resource</span>({
    methods<span class="pl-k">:</span> {
        GET<span class="pl-k">:</span> {
            <span class="pl-en">fn</span><span class="pl-k">:</span> <span class="pl-k">function</span> (<span class="pl-smi">url</span>, <span class="pl-smi">body</span>, <span class="pl-smi">headers</span>) {
                <span class="pl-k">return</span> <span class="pl-s"><span class="pl-pds">'</span>Welcome to <span class="pl-pds">'</span></span> <span class="pl-k">+</span> <span class="pl-v">this</span>.<span class="pl-smi">method_context</span>.<span class="pl-smi">route_name</span> <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">"</span>!<span class="pl-pds">"</span></span>;
            },
            route_name<span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>here<span class="pl-pds">"</span></span>
        }
    }
}));</pre></div>

<p>As always, this context information will also be available to all middleware</p>

<div class="highlight highlight-source-js"><pre><span class="pl-smi">road</span>.<span class="pl-en">use</span>(<span class="pl-k">function</span> (<span class="pl-smi">method</span>, <span class="pl-smi">url</span>, <span class="pl-smi">body</span>, <span class="pl-smi">headers</span>, <span class="pl-smi">next</span>) {
    <span class="pl-k">if</span> (<span class="pl-v">this</span>.<span class="pl-smi">method_context</span>.<span class="pl-smi">route_name</span>) {
        <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-v">this</span>.<span class="pl-smi">method_context</span>.<span class="pl-smi">route_name</span>);
    }

    <span class="pl-k">return</span> <span class="pl-en">next</span>(); 
});</pre></div>

<h5>
<a id="errors" class="anchor" href="#errors" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Errors</h5>

<p>If a resource could not be located for the provided request path, the request method will throw an <a href="#roadshttperror">HttpError</a> with a 404 status code.</p>

<div class="highlight highlight-source-js"><pre><span class="pl-smi">road</span>.<span class="pl-en">request</span>(<span class="pl-s"><span class="pl-pds">'</span>GET<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>/invalidpath<span class="pl-pds">'</span></span>)
    .<span class="pl-en">catch</span>(<span class="pl-k">function</span> (<span class="pl-smi">error</span>) {
        <span class="pl-smi">error</span>.<span class="pl-c1">status</span> <span class="pl-k">===</span> <span class="pl-c1">404</span>
    });</pre></div>

<p>If a resource was located for the provided request path, but the resource did not have a matching <a href="#resource-method">resource method</a>, the request method will throw an <a href="#roadshttperror">HttpError</a> with a 405 status code.</p>

<div class="highlight highlight-source-js"><pre><span class="pl-smi">road</span>.<span class="pl-en">request</span>(<span class="pl-s"><span class="pl-pds">'</span>FAKE_METHOD<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>/users<span class="pl-pds">'</span></span>)
    .<span class="pl-en">catch</span>(<span class="pl-k">function</span> (<span class="pl-smi">error</span>) {
        <span class="pl-smi">error</span>.<span class="pl-c1">status</span> <span class="pl-k">===</span> <span class="pl-c1">405</span>
    });</pre></div>

<h5>
<a id="context" class="anchor" href="#context" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Context</h5>

<p>Each resource method has access to a request context through <code>this</code>. Each <code>this</code> will be unique to the request, and will persist from each request handler (assigned via <code>use</code>) into the actual request. The context is pre-loaded with four variables, listed below.</p>

<table>
<thead>
<tr>
<th>name</th>
<th>type</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>request</td>
<td>function</td>
<td>An alias for <a href="#roadrequeststring-method-string-url-dynamic-body-object-headers">Road.request</a>. You may add any additional methods or properties to the context and use them in your routes. This is useful for determining the authenticated user or adding helper methods.</td>
</tr>
<tr>
<td>http_methods</td>
<td>array</td>
<td>And array of valid http methods for the resource associated with this method (primarily used for OPTIONS requests and 405 errors)</td>
</tr>
<tr>
<td>Response</td>
<td>Response</td>
<td>The Response constructor, so you don't have to load the file each time</td>
</tr>
<tr>
<td>resource_context</td>
<td>mixed</td>
<td>The contents of the context variable passed into the Resource constructor</td>
</tr>
</tbody>
</table>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> road <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">Road</span>(<span class="pl-k">new</span> <span class="pl-en">Resource</span>({
    methods<span class="pl-k">:</span> {
        <span class="pl-en">GET</span><span class="pl-k">:</span> <span class="pl-k">function</span> (<span class="pl-smi">url</span>, <span class="pl-smi">body</span>, <span class="pl-smi">headers</span>) {
            <span class="pl-c">// true because the middleware persists to this context</span>
            <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-v">this</span>.<span class="pl-smi">uri</span> <span class="pl-k">===</span> <span class="pl-s"><span class="pl-pds">'</span>/me<span class="pl-pds">'</span></span>);

            <span class="pl-c">// Access the resource context for additional useful information</span>
            <span class="pl-k">if</span> (<span class="pl-v">this</span>.<span class="pl-smi">resource_context</span>.<span class="pl-smi">require_authentication</span>) {
                <span class="pl-c">// Here you could ensure that authentication was provided to the server Here you could ensure that authentication was provided to the server </span>
            }

            <span class="pl-c">// true. There's only one method, so the array only contains GET</span>
            <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-v">this</span>.<span class="pl-smi">http_methods</span> <span class="pl-k">===</span> [<span class="pl-s"><span class="pl-pds">'</span>GET<span class="pl-pds">'</span></span>]);

            <span class="pl-c">// Easy access to the response object</span>
            <span class="pl-k">return</span> <span class="pl-k">new</span> <span class="pl-en">this.Response</span>(<span class="pl-s"><span class="pl-pds">'</span>hello world<span class="pl-pds">'</span></span>, <span class="pl-c1">200</span>);
        }
    },
    context<span class="pl-k">:</span> {
        require_authentication<span class="pl-k">:</span> <span class="pl-c1">true</span>
    }
}));

<span class="pl-c">// Modifying context will persist into the resource method</span>
<span class="pl-smi">road</span>.<span class="pl-en">use</span>(<span class="pl-k">function</span> (<span class="pl-smi">method</span>, <span class="pl-smi">url</span>, <span class="pl-smi">body</span>, <span class="pl-smi">headers</span>, <span class="pl-smi">next</span>) {
    <span class="pl-v">this</span>.<span class="pl-smi">uri</span> <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">'</span>/me<span class="pl-pds">'</span></span>;
    <span class="pl-k">return</span> <span class="pl-en">next</span>();
});</pre></div>

<h2>
<a id="roadsresponse" class="anchor" href="#roadsresponse" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Roads.Response</h2>

<p>The response object contains all of the information you want to send to the client. This includes the body, status code and all applicable headers. </p>

<h3>
<a id="new-responsemixed-body-number-status-object-headers" class="anchor" href="#new-responsemixed-body-number-status-object-headers" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>new Response(<em>mixed</em> body, <em>number</em> status, <em>Object</em> headers)</h3>

<p><strong>Constructor</strong></p>

<table>
<thead>
<tr>
<th>name</th>
<th>type</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>body</td>
<td>mixed</td>
<td>The body of the response.</td>
</tr>
<tr>
<td>status</td>
<td>number</td>
<td>The HTTP Status code.</td>
</tr>
<tr>
<td>headers</td>
<td>object</td>
<td>Key value pairs of http headers.</td>
</tr>
</tbody>
</table>

<p>Create a response object. </p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">new</span> <span class="pl-en">Response</span>({<span class="pl-s"><span class="pl-pds">"</span>uri<span class="pl-pds">"</span></span><span class="pl-k">:</span> <span class="pl-s"><span class="pl-pds">"</span>...<span class="pl-pds">"</span></span>}, <span class="pl-c1">200</span>, {<span class="pl-s"><span class="pl-pds">"</span>last-modified<span class="pl-pds">"</span></span><span class="pl-k">:</span><span class="pl-s"><span class="pl-pds">"</span>2014-04-27 00:00:00<span class="pl-pds">"</span></span>});</pre></div>

<h3>
<a id="body" class="anchor" href="#body" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Body</h3>

<p><strong>The raw JavaScript object returned by the request</strong></p>

<div class="highlight highlight-source-js"><pre><span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-smi">response</span>.<span class="pl-c1">body</span>);</pre></div>

<h3>
<a id="status" class="anchor" href="#status" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Status</h3>

<p><strong>The HTTP status returned by the request</strong></p>

<div class="highlight highlight-source-js"><pre><span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-smi">response</span>.<span class="pl-c1">status</span>);</pre></div>

<h3>
<a id="headers" class="anchor" href="#headers" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Headers</h3>

<p><strong>A JavaScript object of all response headers</strong></p>

<div class="highlight highlight-source-js"><pre><span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-smi">response</span>.<span class="pl-c1">headers</span>);</pre></div>

<h3>
<a id="responsewritetoserverserverresponse-http_response" class="anchor" href="#responsewritetoserverserverresponse-http_response" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Response.writeToServer(<em>ServerResponse</em> http_response)</h3>

<p><strong>A helper function to write the response object to a server response</strong></p>

<p>This will apply the body, status code, and any applicable headers to the provided http_response. It will not end the response, so you need to do that yourself. If the body is a JavaScript object, and no content-type header is set, the response will be sent through JSON.stringify, and the content-type header will be set to <code>application/json</code>.</p>

<div class="highlight highlight-source-js"><pre><span class="pl-c">// Use middleware to automatically apply a response wrapper</span>
<span class="pl-smi">road</span>.<span class="pl-en">use</span>(<span class="pl-smi">roads</span>.<span class="pl-smi">middleware</span>.<span class="pl-en">standard</span>());

<span class="pl-c">// execute the route logic and retrieve the appropriate response object</span>
<span class="pl-smi">road</span>.<span class="pl-en">request</span>(<span class="pl-smi">http_request</span>.<span class="pl-c1">method</span>, <span class="pl-smi">http_request</span>.<span class="pl-smi">url</span>, body, <span class="pl-smi">http_request</span>.<span class="pl-c1">headers</span>)
    .<span class="pl-en">then</span>(<span class="pl-k">function</span> (<span class="pl-smi">response</span>) {
        <span class="pl-c">// Write the response to the server</span>
        <span class="pl-smi">response</span>.<span class="pl-en">writeToServer</span>(http_response);
        <span class="pl-smi">http_response</span>.<span class="pl-en">end</span>();
    })
    .<span class="pl-en">catch</span>(<span class="pl-k">function</span> (<span class="pl-smi">error</span>) {
        <span class="pl-c">// be careful throwing an error in a response like this</span>
        <span class="pl-c">// errors might expose sensitive data</span>
        (<span class="pl-k">new</span> <span class="pl-en">roads.Response</span>(error, <span class="pl-c1">500</span>)).<span class="pl-en">writeToServer</span>(http_response);
        <span class="pl-smi">http_response</span>.<span class="pl-en">end</span>();
    });</pre></div>

<h2>
<a id="roadshttperror" class="anchor" href="#roadshttperror" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Roads.HttpError</h2>

<h3>
<a id="new-httperrorstring-message-number-code" class="anchor" href="#new-httperrorstring-message-number-code" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>new HttpError(<em>string</em> message, <em>number</em> code)</h3>

<p><strong>A helper error, that contains information relevant to common HTTP errors</strong></p>

<table>
<thead>
<tr>
<th>name</th>
<th>type</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>message</td>
<td>string</td>
<td>A message describing the HTTP error</td>
</tr>
<tr>
<td>code</td>
<td>number</td>
<td>An official http status code</td>
</tr>
</tbody>
</table>

<div class="highlight highlight-source-js"><pre><span class="pl-k">throw</span> <span class="pl-k">new</span> <span class="pl-en">Roads.HttpError</span>(<span class="pl-s"><span class="pl-pds">'</span>Page not found<span class="pl-pds">'</span></span>, <span class="pl-c1">404</span>);</pre></div>

<h3>
<a id="constants" class="anchor" href="#constants" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Constants</h3>

<p>These constants make it easier to keep track of some common error status codes. For more information on what they mean, check out (httpstatus.es)[<a href="http://httpstatus.es">http://httpstatus.es</a>]</p>

<pre><code>HttpError.invalid_request = 400;
HttpError.unauthorized = 401;
HttpError.forbidden = 403;
HttpError.not_found = 404;
HttpError.method_not_allowed = 405;
HttpError.not_acceptable = 406;
HttpError.conflict = 409;
HttpError.gone = 410;
HttpError.unprocessable_entity = 422;
HttpError.too_many_requests = 429;
HttpError.internal_server_error = 500;
</code></pre>

<h2>
<a id="roadsmiddleware" class="anchor" href="#roadsmiddleware" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Roads.middleware</h2>

<h3>
<a id="killslash" class="anchor" href="#killslash" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>killSlash()</h3>

<p><strong>Middleware to kill the trailing slash on http requests</strong></p>

<p>If used, any url that ends with a trailing slash will return a response object redirecting the client to the same url without the trailing slash (302 redirect with Location: [url_without_slash])</p>

<div class="highlight highlight-source-js"><pre><span class="pl-smi">road</span>.<span class="pl-en">use</span>(<span class="pl-smi">roads</span>.<span class="pl-smi">middleware</span>.<span class="pl-smi">killSlash</span>);</pre></div>

<h3>
<a id="corsarraystring-allow_origins-array-allow_headers" class="anchor" href="#corsarraystring-allow_origins-array-allow_headers" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>cors(<em>Array|string</em> allow_origins, <em>array</em> allow_headers)</h3>

<p><strong>Middleware to Apply proper cors headers</strong></p>

<p>Sets up the proper preflight, and standard repsonse headers so that browsers can make proper CORS requests.</p>

<table>
<thead>
<tr>
<th>name</th>
<th>type</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>allow_origins</td>
<td>Array</td>
<td>string</td>
</tr>
<tr>
<td>allow_headers</td>
<td>Array</td>
<td>(optional) A white list of headers that the client is allowed to send in their requests</td>
</tr>
</tbody>
</table>

<div class="highlight highlight-source-js"><pre><span class="pl-smi">road</span>.<span class="pl-en">use</span>(<span class="pl-smi">roads</span>.<span class="pl-smi">middleware</span>.<span class="pl-en">cors</span>([<span class="pl-s"><span class="pl-pds">'</span>http://localhost:8080<span class="pl-pds">'</span></span>], [<span class="pl-s"><span class="pl-pds">'</span>authorization<span class="pl-pds">'</span></span>]));</pre></div>

<h2>
<a id="roadsbuildstring-input_file-string-output_file-object-options" class="anchor" href="#roadsbuildstring-input_file-string-output_file-object-options" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Roads.build(<em>string</em> input_file, <em>string</em> output_file, <em>object</em> options)</h2>

<p><strong>Browserify function to convert your script to run in the browser</strong></p>

<table>
<thead>
<tr>
<th>name</th>
<th>type</th>
<th>description</th>
</tr>
</thead>
<tbody>
<tr>
<td>input_file</td>
<td>string</td>
<td>The source file that will be converted to use in the browser</td>
</tr>
<tr>
<td>output_file</td>
<td>string</td>
<td>The output file that will be accessible by your browser</td>
</tr>
<tr>
<td>options</td>
<td>object</td>
<td>A set of options that can influence the build process. See all fields below</td>
</tr>
<tr>
<td>options.babelify</td>
<td>object</td>
<td>An object containing parameters to pass to the babelify transform</td>
</tr>
<tr>
<td>options.envify</td>
<td>object</td>
<td>An object to pass to envify. This allows you to change values between your server and client scripts.</td>
</tr>
<tr>
<td>options.exclude</td>
<td>array</td>
<td>An array of files that should not be included in the build process.</td>
</tr>
<tr>
<td>options.external</td>
<td>array</td>
<td>An array of dependencies that should be included from exernal resources instead of built into the project</td>
</tr>
<tr>
<td>options.use_sourcemaps</td>
<td>boolean</td>
<td>Whether or not the build process should include source maps.</td>
</tr>
</tbody>
</table>

<pre><code>require('roads')
    .build(__dirname + '/static/client.js', __dirname + '/static/client.brws.js', {
        use_sourcemaps: true,
        roads: {
            output_file: './static/roads.brws.js',
        },
        external: ['react'],
        babelify: {presets: ['react']}
    });
</code></pre>

<h2>
<a id="roadspjaxobject-road" class="anchor" href="#roadspjaxobject-road" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Roads.PJAX(<em>Object</em> road)</h2>

<p><strong>A helper object to easily enable PJAX on your website using roads</strong></p>

<p>PJAX stands for pushState + AJAX. PJAX a technique for speeding up webpages by replacing certain links on the page with AJAX calls. To enable PJAX, you must register the PJAX handler via JavaScript and add attributes to some of your html links.</p>

<h3>
<a id="pjaxregisterobject-window-domelement-container_element" class="anchor" href="#pjaxregisterobject-window-domelement-container_element" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>PJAX.register(<em>Object</em> window, <em>DomElement</em> container_element)</h3>

<p>On page load, you will need to construct and register your PJAX handler. Registration takes two parameters, the window object an a DomElement. When you click certain links in your html (as defined by the link format below), PJAX will intercept the action and instead use roads to generate the new page content. Once the new html is ready, it will replace the innerHTML of the container_element.</p>

<p>This allows for clean, quick page refreshes via JavaScript, with a safe, JavaScript free fallback (the links will still work as normal without JavaScript!).</p>

<pre><code>var road = ...; // Incomplete. See the getting started section for more information about creating a road
var pjax = new require('roads').PJAX(road);
pjax.register(window, document.getElementById('container'));
</code></pre>

<h3>
<a id="pjax-link-format" class="anchor" href="#pjax-link-format" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>PJAX Link Format</h3>

<p>If you would like a link to run via PJAX instead of a new page load, simply add the following data attribute</p>

<p><code>data-roads="link"</code></p>

<p>e.g.</p>

<p><code>&lt;a href="/home" data-roads="link"&gt;Home&lt;/a&gt;</code></p>

<h3>
<a id="pjax-page-titles" class="anchor" href="#pjax-page-titles" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>PJAX Page titles</h3>

<p>To handle page titles you will need to add matching middleware to your server, and your client road. Roads already includes a simple form of this via the setTitle middleware, and the PJAX function addTitleMiddleware.</p>

<p>Your server should include the following:</p>

<div class="highlight highlight-source-js"><pre><span class="pl-k">var</span> roads <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>roads<span class="pl-pds">'</span></span>);
<span class="pl-k">var</span> road <span class="pl-k">=</span> <span class="pl-k">...</span>; <span class="pl-c">// Incomplete. See the getting started section for more information about creating a road</span>
<span class="pl-smi">road</span>.<span class="pl-en">use</span>(<span class="pl-smi">roads</span>.<span class="pl-smi">middleware</span>.<span class="pl-smi">setTitle</span>);</pre></div>

<div class="highlight highlight-source-js"><pre>
<span class="pl-k">var</span> roads <span class="pl-k">=</span> <span class="pl-c1">require</span>(<span class="pl-s"><span class="pl-pds">'</span>roads<span class="pl-pds">'</span></span>);
<span class="pl-k">var</span> road <span class="pl-k">=</span> <span class="pl-k">...</span>; <span class="pl-c">// Incomplete. See the getting started section for more information about creating a road</span>

<span class="pl-k">var</span> pjax <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-en">roads.PJAX</span>(road);
<span class="pl-smi">pjax</span>.<span class="pl-en">addTitleMiddleware</span>();
<span class="pl-smi">pjax</span>.<span class="pl-en">register</span>(<span class="pl-c1">window</span>, <span class="pl-c1">document</span>.<span class="pl-c1">getElementById</span>(<span class="pl-s"><span class="pl-pds">'</span>container<span class="pl-pds">'</span></span>));</pre></div>

<h3>
<a id="isomorphic-pjax-tips" class="anchor" href="#isomorphic-pjax-tips" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Isomorphic PJAX tips</h3>

<p>There's a very easy pattern to follow to ensure sharing client and server code works successfully via PJAX.</p>

<ol>
<li>Your layout (everything wrapping the PJAX container) should be added via middleware. This middleware should not be used when built in the client.</li>
<li>You should have one road that contains all of your public controllers, and one road that contains all of your private controllers
2a. Your public controller should only contain public data, and interact with the rest of your system via HTTP. e.g. instead of making DB calls, these controllers would make HTTP requests to a separate API. This pattern is GREAT, and worthy of another entire article.
2b. Private controllers aren't absolutely necessary, but may come into play if you need authentication or filesystem access for certain pages.</li>
</ol>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/Dashron/roads">Roads</a> is maintained by <a href="https://github.com/Dashron">Dashron</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

            <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-45276947-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>

  </body>
</html>
