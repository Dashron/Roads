{"name":"Roads","tagline":"A node.js web framework","body":"# The Roads.js API Framework\r\n\r\nRoads is a framework for creating APIs in node.js. It requires generator support, so you should be using node 0.11.13 or higher with the `--harmony` flag enabled.\r\n\r\n# Why should I use Roads?\r\n\r\n1. It helps build an organized, resource oriented API through a nested routing structure.\r\n2. Can be invoked over HTTP, or directly inside of javascript.\r\n3. It is built using generators and promises so that you never have to worry about callbacks.\r\n4. Can be used with roads-fieldsfilter to support lazy responses, only executing the code your users need.\r\n\r\n\r\n# Index\r\n\r\n - [Getting Started](#getting-started)\r\n - [Roads.API](#roadsapi)\r\n  - [new API(*Resource* root_resource)](#new-apiresource-root_resource)\r\n  - [onRequest(*Function* fn)](#apionrequestfunction-fn)\r\n  - [request(*string* method, *string* url, *dynamic* body, *Object* headers)](#apirequeststring-method-string-url-dynamic-body-object-headers)\r\n  - [server(*IncomingMessage* http_request, *ServerResponse* http_response)](#apiserverincomingmessage-http_request-serverresponse-http_response)\r\n - [Roads.Resource](#roadsresource)\r\n  - [new Resource(*Object* definition)](#new-resourceobject-definition)\r\n  - [URL Part (routing)](#url-part)\r\n  - [Resource method](#resource-method)\r\n - [Roads.Response](#roadsresponse)\r\n  - [new Response(*Object* data, *number* status, *Object* headers)](#new-responsedynamic-data-number-status-object-headers)\r\n  - [data](#data)\r\n  - [status](#status)\r\n  - [headers](#headers)\r\n  - [writeTo(*ServerResponse* httpResponse)](#responsewritetoserverserverresponse-http_response)\r\n - [Roads.HttpError](#roadshttperror)\r\n  - [new HttpError(*string* message, *number* code)](#new-httperrorstring-message-number-code)\r\n - [Performance Improvements](#performance-improvements)\r\n\r\n## Getting Started\r\n\r\nBuilding an API with roads follows a fairly simple workflow.\r\n\r\n1. Create a [Resource](#roadsresource) object for every endpoint (`/`, `/users`, `/posts`, `/users/#user_id`)\r\n```\r\n    // Create your resource.\r\n    var resource = new roads.Resource({\r\n        // Define sub-resources.\r\n        resources : {\r\n            // This implies that the files \"users.js\" and \"posts.js\" contain resource objects.\r\n            \"users\" : require('./users'),\r\n            \"posts\" : require('./posts')\r\n        },\r\n        // Incomplete. See step 2.\r\n        methods : ...\r\n    });\r\n    \r\n    // Assign your resource to the root \"/\" endpoint.\r\n    var api = new roads.API(resource);\r\n```\r\n\r\n2. Each [Resource](#roadsresource) from step #1 should contain one or more [resource methods](#resource-method). Each resource method is associated with an HTTP method.\r\n```\r\n    var resource = new roads.Resource({\r\n        // Incomplete. See step 1.\r\n        resources : ...,\r\n        methods : {\r\n            GET : function (url, body, headers) {\r\n                // URL query string parameter.\r\n                url.query.page;\r\n\r\n                // JSON or query string body, parsed depending on the content-type header.\r\n                body.name;\r\n\r\n                // Incomplete, see step 3.\r\n                return ...\r\n            }\r\n        }\r\n    });\r\n```\r\n\r\n3. Each [resource method](#resource-method) from step #2 should return a [response](#roadsresponse) object. \r\n```\r\n    var resource = new roads.Resource({\r\n        // Incomplete. See step 1.\r\n        resources : ...,\r\n        methods : {\r\n            GET : function (url, body, headers) {\r\n                // Incomplete, see step 2.\r\n                ...\r\n\r\n                // Build a response object, with the body, status code and headers.\r\n                return new roads.Resource({ \"name\" : \"aaron\" }, 200, {\"last-modified\" : \"Tue, 15 Nov 1994 12:45:26 GMT\"});\r\n            }\r\n        }\r\n    });\r\n```\r\n\r\n4. Interact with the API directly, or bind it to an HTTP serber\r\n\r\n```\r\n    // Call directly\r\n    api.request('GET', '/users', {page : 2})\r\n        .then(function (response) {\r\n            if (response.status >= 400) {\r\n                throw new Error(response.data, response.status);\r\n            }\r\n            \r\n            console.log(response.data);\r\n        });\r\n```\r\n\r\n```\r\n    // Bind to an HTTP server\r\n    require('http').createServer(api.server.bind(api))\r\n        .listen(8080, function () {\r\n            console.log('server has started');\r\n        });\r\n```\r\n\r\nOnce all of these steps are complete, you should be able to access the API through your browser. Continue reading the docs below for more information on [error handling](#apionrequestfunction-fn), [URL parameters](#url-part) and more!\r\n\r\n\r\n\r\n## Roads.API\r\n\r\nThe API is a container that holds a hierarchy of [Resource](#roadsresource) objects. It exposes a [request](#apirequeststring-method-string-url-dynamic-body-object-headers) method which allows you to interact directly with the resources.\r\n\r\nYou must provide the root resource to the constructor. This resource will resolve any requests to the root (`/`) endpoint. Any additional routes will be referenced as sub-resources of the root endpoint.\r\n\r\n\r\n\r\n### new API(*Resource* root_resource)\r\n**Create an API object.**\r\n\r\n name          | type                       | required | description\r\n --------------|----------------------------|----------|-------------\r\n root_resource | [Resource](#roadsresource) | yes      | Used to generate the [response](#roadsresponse) for the root endpoint ( [protocol]://[host]/ ).\r\n\r\nCreates your API object. You must provide a [Resource](#roadsresource) to the constructor. The provided resource becomes the root resource, and will be used for any API requests to `/`.\r\n\r\n```node\r\nvar roads = require('roads');\r\nvar root_resource = new roads.Resource(...); // The resource definition has not been set here, because it's out of the scope of this example. Take a look at [Resource](#roadsresource) for information about the Resource constructor.\r\nvar api = new roads.API(root_resource);\r\n```\r\n\r\n\r\n\r\n### API.onRequest(*Function* fn)\r\n**Add a custom function to be executed along with every request.**\r\n\r\n name | type                                                                  | required | description\r\n -----|-----------------------------------------------------------------------|----------|---------------\r\n fn   | Function(*string* method, *string* url,*object* body,*object* headers,*function* next) | yes      | Will be called any time a request is made on the API object.\r\n \r\n This will be called for every request, even for routes that do not exist. The callback will be executed with the following five parameters :\r\n \r\n#### onRequest Callback \r\n**function (*string* method,*string* url, *Object* body, *Object* headers, *Function* next)**\r\n\r\nname     | type                               | description\r\n --------|------------------------------------|---------------\r\n method  | string                             | The HTTP method that was provided to the request\r\n url     | string                             | The URL that was provided to the request\r\n body    | object                             | The body that was provided to the request, after it was properly parsed into an object\r\n headers | object                             | The headers that were provided to the request\r\n next    | function                           | The [resource method](#resource-method) that the router located. Execute this function to perform the standard API action for this HTTP method and URL. This method will always return a promise.\r\n\r\nIf the callback does not return a [response](#roadsresponse) object, it will be wrapped in a [response](#roadsresponse) object with the default status code of 200.\r\n\r\n    // Example of an onRequest handler\r\n    api.onRequest(function* (url, body, headers, next) {\r\n    \t// kill trailing slash as long as we aren't at the root level\r\n        if (url.path != '/' && url.path[url.path.length - 1] === '/') {\r\n            return new roads.Response(null, 302, {\r\n                location : url.path.substring(0, url.path.length - 1)\r\n            });\r\n        }\r\n    \r\n        // This would also be a good place to identify the authenticated user, or API app and add it to the current request context\r\n        // eg: this.cur_user = user;\r\n\r\n        // execute the actual resource method, and return the response\r\n        return next()\r\n            // Catch any errors that are thrown by the resources\r\n            .catch (function (err) {\r\n                // Wrap the errors in response objects. If they are [HttpErrors](#roadshttperror) we adjust the status code\r\n                switch (err.code) {\r\n                    case 404:\r\n                        return new roads.Response(notFoundRepresentation(err), 404);\r\n                    case 405:\r\n                        return new roads.Response(notAllowedRepresentation(err), 405);\r\n                    case 500:\r\n                    default:\r\n                        return new roads.Response(unknownRepresentation(err), 500);\r\n                }\r\n            });\r\n    });\r\n\r\n\r\n\r\n### API.request(*string* method, *string* url, *dynamic* body, *Object* headers)\r\n**Make a request to the API.**\r\n\r\n\r\nThis function will locate the appropriate [resource method](#resource-method) for the provided HTTP Method and URL, execute it and return a [thenable (Promises/A compatible promise)](http://wiki.commonjs.org/wiki/Promises/A). It will always return a [Response](#roadsresponse) object.\r\n\r\n    var promise = api.request('GET', '/users/dashron');\r\n    \r\n    promise.then(function (response) {        \r\n        console.log(response.data);\r\n    });\r\n\r\n    promise.catch(function (error) {\r\n        console.log(error);\r\n    });\r\n\r\n\r\n\r\n### API.server(*IncomingMessage* http_request, *ServerResponse* http_response)\r\n**An onRequest callback for http.createServer()**\r\n\r\nHelper function so the API can be thrown directly into http.createServer.\r\n\r\n    require('http').createServer(api.server.bind(api))\r\n        .listen(8081, function () {\r\n            console.log('server has started');\r\n        });\r\n\r\n\r\n\r\n## Roads.Resource\r\n\r\nEach resource represents a single endpoint. The definition provided to the constructor describes how it can be used by the API object.\r\n\r\n\r\n\r\n### new Resource(*Object* definition)\r\n**Constructor**\r\n\r\nname        | type                               | description\r\n -----------|------------------------------------|---------------\r\n definition | object                             | A definition which describes how the resource should operate\r\n\r\nThe definition only looks for two fields.\r\n\r\nname        | type                               | description\r\n -----------|------------------------------------|---------------\r\n resources  | object                             | Each key is a [URL part](#url-part), and each value is a sub-[resource](#roadsresource)\r\n methods    | object                             | Each key is an HTTP method, and each value is a [resource method](#resource-method).\r\n\r\n    module.exports.many = new Resource({\r\n        resources : {\r\n            'users' : require('./users').many,\r\n            'posts' : require('./posts').many\r\n        },\r\n        methods : {\r\n            GET : function* (url, body, headers) {\r\n                return new Response({\r\n                    \"users\" : \"/users\",\r\n                    \"posts\" : \"/posts\"\r\n                });\r\n            }\r\n        }\r\n    });\r\n\r\n#### URL Part (routing)\r\n\r\nAll URL routing happens through the resource definition, and through sub resources. The root resource represents a URL without any path ([protocol]://[host]/). This root resource must define additional resources as sub resources, which will branch out after the root resource.\r\n\r\nPart       | Example   | Example values | Description\r\n-----------|-----------|----------------|--------------\r\n{literal}  | users     | users          | The provided value must explicitly match the [URL part](#url-part)\r\n#{key}     | #user_id  | 12445          | The provided value must be numeric\r\n${key}     | #username | dashron        | The provided value can be any series of non-forward slash, URL valid characters\r\n\r\nIn the following example, the only valid URLs are /, /users and /users/{number}\r\n\r\n    var single = new Resource({\r\n    });\r\n\r\n    var many = new Resource({\r\n        resources : {\r\n            \"#user_id\" : single\r\n        }\r\n    });\r\n\r\n    var root = new Resource({\r\n        resources : {\r\n            \"users\" : many\r\n        }\r\n    });\r\n\r\nFor variable fields, you can retrieve the variable in the URL parameter. The URL parameter will be an object, and will have an \"args\" parameter\r\n\r\n    var single = new Resource({\r\n        methods : function (url, body, headers) {\r\n            console.log(url.args.user_id);\r\n        }\r\n    });\r\n\r\n    var many = new Resource({\r\n        resources : {\r\n            \"#user_id\" : single\r\n        }\r\n    });\r\n\r\n    var root = new Resource({\r\n        resources : {\r\n            \"users\" : many\r\n        }\r\n    });\r\n\r\n#### Resource Method\r\n\r\nEach ```method : function``` pair of the methods field describes how the API server will respond to an HTTP request. The function is called a \"resource method\".\r\n\r\nIf a resource could not be located for the provided URL, the API will throw an [HttpError](#roadshttperror) with a 404 status code.\r\nIf a resource was located for the provided URL, but the resource did not have the appropriate [resource method](#resource-method) for the requested HTTP method, the API will throw an [HttpError](#roadshttperror) with a 405 status code.\r\n\r\nEach resource method has access to a request context through ```this```. Each ```this``` will be unique to the request, and will persist from the requestHandler into the actual request. The context is pre-loaded with a request method, which is an alias for [API.request](#apirequeststring-method-string-url-dynamic-body-object-headers). You may add any additional methods or properties to the context.\r\n\r\n    var api = new API(new Resource({\r\n        methods : {\r\n            GET : function (url, body, headers) {\r\n                // true\r\n                console.log(this.uri === '/me');\r\n            }\r\n        }\r\n    }));\r\n\r\n    api.onRequest(function* (method, url, body, headers, next) {\r\n        this.uri = '/me';\r\n        return yield next();\r\n    });\r\n\r\n\r\n\r\n## Roads.Response\r\n\r\nThe response object contains all of the information you want to send to the client. This includes the body, status code and all applicable headers. \r\n\r\n\r\n\r\n### new Response(*dynamic* data, *number* status, *Object* headers)\r\n**Constructor**\r\n\r\nname        | type                               | description\r\n -----------|------------------------------------|---------------\r\n data       | dynamic                            | The body of the response. If provided a JavaScript object, and no content-type header, the response will be sent through JSON.stringify, and the content-type header will be set to `application/json`\r\n status     | number                             | The HTTP Status code\r\n headers    | object                             | Key value pairs of http headers.\r\n\r\nCreate a response object. \r\n\r\n    new Response({\"uri\" : \"...\"}, 200, {\"last-modified\":\"2014-04-27 00:00:00\"});\r\n\r\n### Data\r\n**The raw JavaScript object returned by the API request**\r\n\r\n```\r\n    console.log(response.data);\r\n```\r\n\r\n### Status\r\n**The HTTP status returned by the API request**\r\n\r\n```\r\n    console.log(response.status);\r\n```\r\n\r\n### Headers\r\n**A JavaScript object of all response headers**\r\n\r\n```\r\n    console.log(response.headers);\r\n```\r\n\r\n\r\n### Response.writeToServer(*ServerResponse* http_response)\r\n**A helper function to write the response object to a server response**\r\n\r\nThis will apply the body, status code, and any applicable headers to the provided http_response. It will not end the response, so you need to do that yourself.\r\n\r\n    // execute the API logic and retrieve the appropriate response object\r\n    api.request(http_request.method, http_request.url, body, http_request.headers)\r\n        .then(function (response) {\r\n            // Get the data\r\n            response.writeToServer(http_response);\r\n            http_response.end();\r\n        })\r\n        .catch(function (error) {\r\n            // be careful throwing an error in a response like this\r\n            // errors might expose sensitive data\r\n            (new roads.Response(error, 500)).writeToServer(http_response);\r\n            http_response.end();\r\n        });\r\n\r\n\r\n\r\n## Roads.HttpError\r\n\r\n### new HttpError(*string* message, *number* code)\r\n**A helper error, that contains information relevant to common HTTP errors**\r\n\r\nname        | type                               | description\r\n -----------|------------------------------------|---------------\r\n message    | string                             | A message describing the HTTP error\r\n code       | number                             | An official [http status code](#http://www.httpstatus.es)\r\n\r\n    throw new Roads.HttpError('Page not found', 404);\r\n\r\n\r\n\r\n### Performance improvements\r\n\r\nIt's possible to design your API responses to achieve significant performance gains. [Roads Fields Filter](https://github.com/Dashron/roads-fieldsfilter) helps facilitate that feature.\r\n\r\n### TODO\r\n\r\nNext step is to build roads-client, a single library that can be run in node, or browsers and can communicate with APIs built on roads. It will expose at least one method, which will have a call signature identical to [API.request](#apirequeststring-method-string-url-dynamic-body-object-headers)\r\n","google":"UA-45276947-1","note":"Don't delete this file! It's used internally to help with page regeneration."}